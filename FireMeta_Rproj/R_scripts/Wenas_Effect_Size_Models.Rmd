---
title: "Wenas_Effect_Size_Models"
output: html_document
date: "2023-11-16"
editor_options: 
  chunk_output_type: console
---

The purpose of this script is to perform models for effect size against burn characterizations 

Script Workflow:

Step 1) Load in the geospatial csv that is generated from pulling in stream cat data

Step 2) Load in the fire name and year summary csv

Step 3) Load in the effect size sheet that comes from the All_Studies_Temporal_Normalization script that includes effect size for each watershed. 

Our model:Effect_size ~ burn_percentage*TSF + (1|Site)


# Status: in progress

# ==============================================================================
# Author: Jake Cavaiani 
# 16 November 2023
# ==============================================================================

## Geospatial data
```{r Jake/Mac Load Packages and}
#for Jake/mac

rm(list=ls(all=T)) #this clears your Environment


library(tidyverse)
library(here)
library(forecastML)
library(zoo)
library(hrbrthemes)
library(viridis)
library(readxl)

```

```{r load in csv's}
options(max.print = 200)

# Geospatial csv from stream cat with only the sites and the total area + the burn percentages 
geospatial <- read_csv(here("R_scripts", "Geospatial_data_2023-11-13.csv")) %>% 
  select(site, comid, totdasqkm, MTBS_1986Ws, MTBS_1987Ws, MTBS_1988Ws, MTBS_1989Ws, MTBS_1990Ws, MTBS_1991Ws, MTBS_1992Ws, MTBS_1993Ws, MTBS_1994Ws, MTBS_1995Ws, MTBS_1996Ws, MTBS_1997Ws, MTBS_1998Ws, MTBS_1999Ws, MTBS_2000Ws, MTBS_2001Ws, MTBS_2002Ws, MTBS_2003Ws, MTBS_2004Ws, MTBS_2005Ws, MTBS_2006Ws, MTBS_2007Ws, MTBS_2008Ws, MTBS_2009Ws, MTBS_2010Ws, MTBS_2011Ws, MTBS_2012Ws, MTBS_2013Ws, MTBS_2014Ws, MTBS_2015Ws, MTBS_2016Ws, MTBS_2017Ws)

# Site summary of each study and its respective fire and the year of that fire
studies_data <- read_excel(here("inputs", "StudiesData_Table1.xlsx"),
    sheet = "Study_info_filtered_V3_Q") %>% 
  select(Study, Fire_name, Fire_year)

# The effect sizes of each study's watershed
effect_size <- read_csv(here("Output_for_analysis", "Effect_Size.csv")) %>% 
  select(Study_ID, response_var, Climate, year, Biome, Site, Effect_size, Time_Since_Fire)

# Read in the study and site csv 
study_site_data <- read_excel(here("inputs", "Studies_Summary", "Fire_name_Lat_Long.xlsx")) %>% 
  select(Study, Site) %>% 
  rename(site = Site, 
         Study_ID = Study) %>% 
  na.omit()


```


```{r - data prep}

# pivoting to make the responses in one column
geospatial_long <- geospatial %>%
  pivot_longer(
    cols = MTBS_1986Ws:MTBS_2017Ws,
    names_to = "year",
    values_to = "burn_percentage",
    values_drop_na = TRUE
  )

fire_clip <- geospatial_long %>% 
  group_by(site) %>% 
  filter(burn_percentage > 0)

```

```{r - plot}
ggplot(geospatial_long, aes(x = seq_along(year), y = burn_percentage)) +
  geom_line() +
  geom_point() +
  facet_wrap(~site, scales = "free") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))




```








